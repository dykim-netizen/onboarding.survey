<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Beyond Music Â· People Team ì˜¨ë³´ë”© ì„¤ë¬¸</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.21.4/babel.min.js"></script>
  <style>* { box-sizing: border-box; margin: 0; padding: 0; }</style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    const CORRECT_PW = "Qwermnbv00!";
    const ROUNDS = ["3ê°œì›”", "6ê°œì›”", "1ë…„"];
    const Q_LABELS = [
      "ì¡°ì§ ë¬¸í™”ì™€ ì¼í•˜ëŠ” ë°©ì‹ì— ì˜ ì ì‘í•˜ê³  ìˆë‹¤",
      "ë™ë£Œë“¤ê³¼ í¸í•˜ê²Œ ì†Œí†µí•˜ê³  ê´€ê³„ í˜•ì„±ì´ ì˜ ë˜ê³  ìˆë‹¤",
      "í˜„ì¬ ë§¡ì€ ì—…ë¬´ê°€ ë‚´ ì—­í• ê³¼ ê¸°ëŒ€ì¹˜ì— ë§ê²Œ ì£¼ì–´ì§€ê³  ìˆë‹¤",
      "ì—…ë¬´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë° í•„ìš”í•œ ì •ë³´ì™€ ì§€ì›ì„ ì¶©ë¶„íˆ ë°›ê³  ìˆë‹¤",
      "íŒ€ì¥(ë¦¬ë”)ê³¼ì˜ ì†Œí†µì´ ì›í™œí•˜ë©° í•„ìš”í•  ë•Œ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆë‹¤",
      "ë¦¬ë”ë¡œë¶€í„° ë‚´ ì„±ì¥ê³¼ ì—…ë¬´ì— ëŒ€í•œ í”¼ë“œë°±ì„ ì¶©ë¶„íˆ ë°›ê³  ìˆë‹¤",
    ];
    const Q_SECTIONS = [
      { title: "ğŸ¢ ì¡°ì§ ì ì‘ë„", qs: [0, 1] },
      { title: "ğŸ’¼ ì—…ë¬´ ë§Œì¡±ë„", qs: [2, 3] },
      { title: "ğŸ¤ ë¦¬ë”ì‹­ ì²´ê°ë„", qs: [4, 5] },
    ];
    const ROUND_COLOR = { "3ê°œì›”": "#A8D5FF", "6ê°œì›”": "#7AB648", "1ë…„": "#2D5016" };
    const ROUND_BG = { "3ê°œì›”": "#EFF8FF", "6ê°œì›”": "#E8F5D8", "1ë…„": "#D6ECC4" };
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbzCe2xlSH5w2rKub_t2C7Pp-1EIR-ZzLAEEKbzE62cOs7U08y9ronPCvgQxX0Kf6B6adg/exec";

    async function sheetGet() {
      const res = await fetch(SHEET_URL);
      return await res.json();
    }

    async function sheetPost(entry) {
      await fetch(SHEET_URL, {
        method: "POST",
        body: JSON.stringify(entry),
      });
    }

    function App() {
      const [tab, setTab] = useState("survey");
      const [resultTab, setResultTab] = useState("trend");
      const [responses, setResponses] = useState([]);
      const [isAuth, setIsAuth] = useState(false);
      const [loading, setLoading] = useState(false);
      const [logoClicks, setLogoClicks] = useState(0);
      const [name, setName] = useState("");
      const [round, setRound] = useState("");
      const [scores, setScores] = useState([0,0,0,0,0,0]);
      const [text7, setText7] = useState("");
      const [text8, setText8] = useState("");
      const [submitted, setSubmitted] = useState(false);
      const [submitting, setSubmitting] = useState(false);
      const [pw, setPw] = useState("");
      const [pwError, setPwError] = useState(false);
      const [csvText, setCsvText] = useState("");
      const [csvOpen, setCsvOpen] = useState(false);
      const [expandedPerson, setExpandedPerson] = useState(null);

      function handleLogoClick() {
        const next = logoClicks + 1;
        setLogoClicks(next);
        if (next >= 5) { setLogoClicks(0); setTab(isAuth ? "results" : "password"); }
      }

      function setScore(qi, val) { const n = [...scores]; n[qi] = val; setScores(n); }

      async function submitSurvey() {
        if (!name.trim() || !round) return alert("ì´ë¦„ê³¼ ì‹œì ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        for (let i = 0; i < 6; i++) if (!scores[i]) return alert(`Q${i+1}ë²ˆ ë‹µë³€ì„ ì„ íƒí•´ì£¼ì„¸ìš”!`);
        setSubmitting(true);
        try {
          const entry = {
            id: Date.now(), name: name.trim(), round,
            date: new Date().toLocaleDateString("ko-KR"),
            scores: [...scores],
            text7: text7||"ì—†ìŒ", text8: text8||"ì—†ìŒ"
          };
          await sheetPost(entry);
          setSubmitted(true);
        } catch (e) {
          alert("ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\n" + e.message);
        }
        setSubmitting(false);
      }

      function resetSurvey() { setName(""); setRound(""); setScores([0,0,0,0,0,0]); setText7(""); setText8(""); setSubmitted(false); setTab("survey"); }

      async function checkPassword() {
        if (pw === CORRECT_PW) {
          setIsAuth(true); setPwError(false); setPw("");
          setTab("results");
          setLoading(true);
          try {
            const data = await sheetGet();
            setResponses(data);
          } catch(e) {
            alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”: " + e.message);
          }
          setLoading(false);
        } else {
          setPwError(true); setPw("");
        }
      }

      function logout() { setIsAuth(false); setTab("survey"); setResponses([]); }

      function downloadCSV() {
        const header = ["ì´ë¦„","ì‹œì ","ë‚ ì§œ",...Q_LABELS.map((_,i)=>`Q${i+1}`),"í‰ê· ","ê°œì„ ì ","ì „ë‹¬ì‚¬í•­"];
        const rows = responses.map(r => {
          const avg = (r.scores.reduce((a,b)=>a+b,0)/r.scores.length).toFixed(1);
          return [r.name, r.round, r.date, ...r.scores, avg, r.text7, r.text8];
        });
        const csv = [header,...rows].map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");
        setCsvText(csv); setCsvOpen(true);
      }

      const byPerson = {};
      responses.forEach(r => {
        if (!byPerson[r.name]) byPerson[r.name] = {};
        byPerson[r.name][r.round] = r;
      });
      const personNames = Object.keys(byPerson);

      const roundAvgs = ROUNDS.map(rd => {
        const rrs = responses.filter(r => r.round === rd);
        if (!rrs.length) return null;
        const qAvgs = Q_LABELS.map((_, qi) => rrs.map(r => r.scores[qi]).reduce((a,b)=>a+b,0)/rrs.length);
        return { count: rrs.length, overall: (qAvgs.reduce((a,b)=>a+b,0)/qAvgs.length).toFixed(1), qAvgs };
      });

      const s = {
        body: { fontFamily: "sans-serif", background: "#F7F4EF", minHeight: "100vh", color: "#1A1A1A" },
        nav: { display: "flex", alignItems: "center", justifyContent: "space-between", padding: "14px 32px", background: "#2D5016", color: "white" },
        logo: { fontFamily: "Georgia, serif", fontSize: 17, cursor: "pointer", userSelect: "none" },
        navBtn: (a) => ({ background: a?"#7AB648":"transparent", border:`1px solid ${a?"#7AB648":"rgba(255,255,255,0.3)"}`, color:"white", padding:"7px 18px", borderRadius:20, fontSize:13, cursor:"pointer", fontFamily:"inherit" }),
        wrap: { maxWidth: 680, margin: "40px auto", padding: "0 24px 80px" },
        hero: { textAlign: "center", marginBottom: 40 },
        tag: { display: "inline-block", background: "#E8F5D8", color: "#2D5016", fontSize: 13, fontWeight: 700, letterSpacing: 2, textTransform: "uppercase", padding: "6px 16px", borderRadius: 20, marginBottom: 14 },
        h1: { fontFamily: "Georgia, serif", fontSize: 34, color: "#2D5016", marginBottom: 10, lineHeight: 1.2 },
        muted: { fontSize: 13, color: "#888", lineHeight: 1.7 },
        metaRow: { display: "flex", gap: 12, marginBottom: 36 },
        input: { flex: 1, background: "white", border: "1.5px solid #E0DDD6", padding: "11px 14px", borderRadius: 10, fontFamily: "inherit", fontSize: 14, color: "#1A1A1A", outline: "none" },
        sectionTitle: { fontSize: 13, fontWeight: 700, letterSpacing: 1.5, textTransform: "uppercase", color: "#2D5016", marginBottom: 14, paddingBottom: 8, borderBottom: "2px solid #E8F5D8" },
        card: { background: "white", border: "1.5px solid #E0DDD6", borderRadius: 14, padding: "14px 22px", marginBottom: 14 },
        qLabel: { fontSize: 14, fontWeight: 500, lineHeight: 1.5, marginBottom: 18, display: "flex", alignItems: "flex-start", gap: 8 },
        qNum: { display: "inline-flex", width: 22, height: 22, background: "#2D5016", color: "white", borderRadius: "50%", fontSize: 11, fontWeight: 700, alignItems: "center", justifyContent: "center", flexShrink: 0, marginTop: 1 },
        scaleWrap: { display: "flex", gap: 8 },
        scaleBtn: (sel) => ({ flex:1, aspectRatio:"1", border:`2px solid ${sel?"#2D5016":"#E0DDD6"}`, borderRadius:10, background:sel?"#2D5016":"#F7F4EF", color:sel?"white":"#999", fontWeight:700, fontSize:15, cursor:"pointer", fontFamily:"inherit" }),
        scaleLabels: { display: "flex", justifyContent: "space-between", marginTop: 6, fontSize: 10, color: "#aaa" },
        textarea: { width: "100%", minHeight: 90, border: "1.5px solid #E0DDD6", borderRadius: 10, padding: "10px 14px", fontFamily: "inherit", fontSize: 13, color: "#1A1A1A", background: "#F7F4EF", resize: "vertical", outline: "none", lineHeight: 1.6, boxSizing: "border-box" },
        submitBtn: { width: "100%", padding: 15, background: "#2D5016", color: "white", border: "none", borderRadius: 12, fontFamily: "inherit", fontSize: 15, fontWeight: 700, cursor: submitting?"not-allowed":"pointer", marginTop: 8, opacity: submitting?0.6:1 },
        pwWrap: { maxWidth: 380, margin: "100px auto", padding: "0 24px", textAlign: "center" },
        pwBtn: { background: "#2D5016", color: "white", border: "none", padding: "12px 20px", borderRadius: 10, fontFamily: "inherit", fontSize: 14, fontWeight: 700, cursor: "pointer" },
        rWrap: { maxWidth: 900, margin: "40px auto", padding: "0 24px 80px" },
        overlay: { position: "fixed", inset:0, background:"rgba(0,0,0,0.5)", zIndex:100, display:"flex", alignItems:"center", justifyContent:"center", padding:24 },
        modal: { background:"white", borderRadius:16, padding:28, width:"100%", maxWidth:480, display:"flex", flexDirection:"column" },
      };

      if (submitted) return (
        <div style={s.body}>
          <nav style={s.nav}><div style={s.logo} onClick={handleLogoClick}>Beyond Music Â· People Team</div></nav>
          <div style={{ textAlign:"center", marginTop:100, padding:"0 24px" }}>
            <div style={{ fontSize:52, marginBottom:16 }}>ğŸŒ¿</div>
            <div style={{ fontFamily:"Georgia, serif", fontSize:28, color:"#2D5016", marginBottom:10 }}>ì œì¶œ ì™„ë£Œ!</div>
            <div style={{ fontSize:14, color:"#888", marginBottom:28 }}>ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•´ìš”.<br/>í”¼í”ŒíŒ€ì´ ê¼¼ê¼¼íˆ í™•ì¸í• ê²Œìš”.</div>
            <button style={{ ...s.submitBtn, maxWidth:300, margin:"0 auto", display:"block" }} onClick={resetSurvey}>í™•ì¸</button>
          </div>
        </div>
      );

      return (
        <div style={s.body}>
          {csvOpen && (
            <div style={s.overlay}>
              <div style={s.modal}>
                <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:12 }}>
                  <div style={{ fontFamily:"Georgia, serif", fontSize:18, color:"#2D5016" }}>ğŸ“‹ CSV ë°ì´í„°</div>
                  <button style={{ background:"transparent", border:"none", fontSize:20, cursor:"pointer", color:"#888" }} onClick={()=>setCsvOpen(false)}>âœ•</button>
                </div>
                <div style={{ fontSize:12, color:"#888", marginBottom:12 }}>ì „ì²´ ì„ íƒ í›„ ë³µì‚¬í•´ì„œ ì—‘ì…€ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.</div>
                <textarea readOnly value={csvText} style={{ fontFamily:"monospace", fontSize:11, border:"1.5px solid #E0DDD6", borderRadius:8, padding:12, resize:"none", background:"#F7F4EF", color:"#1A1A1A", lineHeight:1.6, minHeight:200, width:"100%" }} onClick={e=>e.target.select()} />
                <button style={{ marginTop:12, background:"#2D5016", color:"white", border:"none", padding:10, borderRadius:8, fontFamily:"inherit", fontSize:13, fontWeight:700, cursor:"pointer" }} onClick={()=>{ navigator.clipboard.writeText(csvText).then(()=>alert("ë³µì‚¬ëì–´ìš”!")); }}>ë³µì‚¬í•˜ê¸°</button>
              </div>
            </div>
          )}

          <nav style={s.nav}>
            <div style={s.logo} onClick={handleLogoClick}>Beyond Music Â· People Team</div>
            <div style={{ display:"flex", gap:8 }}>
              <button style={s.navBtn(tab==="survey")} onClick={()=>setTab("survey")}>ğŸ“ ì„¤ë¬¸ ì‘ì„±</button>
              {(tab==="results"||tab==="password") && (
                <button style={s.navBtn(true)} onClick={()=>setTab(isAuth?"results":"password")}>ğŸ“Š ì‘ë‹µ ê²°ê³¼</button>
              )}
            </div>
          </nav>

          {tab==="survey" && (
            <div style={s.wrap}>
              <div style={s.hero}>
                <div style={s.tag}>Quarterly Survey</div>
                <div style={s.h1}>ì§€ê¸ˆ ì–´ë– ì„¸ìš”?</div>
                <div style={s.muted}>ì†”ì§í•œ ë‹µë³€ì´ ë¹„ìš˜ë“œë®¤ì§ì„ ë” ì¢‹ì€ ê³³ìœ¼ë¡œ ë§Œë“¤ì–´ìš”.<br/>3ê°œì›” Â· 6ê°œì›” Â· 1ë…„ ë‹¨ê³„ë³„ë¡œ ì—¬ëŸ¬ë¶„ì˜ ì„±ì¥ì„ í•¨ê»˜ ê¸°ë¡í•´ìš” ğŸŒ¿</div>
              </div>
              <div style={s.metaRow}>
                <input style={s.input} placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" value={name} onChange={e=>setName(e.target.value)} />
                <select style={s.input} value={round} onChange={e=>setRound(e.target.value)}>
                  <option value="">ì‹œì  ì„ íƒ</option>
                  {ROUNDS.map(r=><option key={r} value={r}>{r} ì°¨</option>)}
                </select>
              </div>
              {Q_SECTIONS.map(section => (
                <div key={section.title} style={{ marginBottom:36 }}>
                  <div style={s.sectionTitle}>{section.title}</div>
                  {section.qs.map(qi => (
                    <div key={qi} style={s.card}>
                      <div style={s.qLabel}><span style={s.qNum}>{qi+1}</span><span>{Q_LABELS[qi]}</span></div>
                      <div style={s.scaleWrap}>{[1,2,3,4,5].map(v=>(
                        <button key={v} style={s.scaleBtn(scores[qi]===v)} onClick={()=>setScore(qi,v)}>{v}</button>
                      ))}</div>
                      <div style={s.scaleLabels}><span>ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤</span><span>ë§¤ìš° ê·¸ë ‡ë‹¤</span></div>
                    </div>
                  ))}
                </div>
              ))}
              <div style={{ marginBottom:36 }}>
                <div style={s.sectionTitle}>ğŸ’¬ ê±´ì˜ì‚¬í•­ &amp; ììœ  ì˜ê²¬</div>
                <div style={s.card}>
                  <div style={s.qLabel}><span style={s.qNum}>7</span><span>ì˜¨ë³´ë”© ê³¼ì •ì—ì„œ ì•„ì‰¬ì› ê±°ë‚˜ ê°œì„ ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ì ì´ ìˆë‹¤ë©´ ì ì–´ì£¼ì„¸ìš”.</span></div>
                  <textarea style={s.textarea} placeholder="ì—†ìœ¼ë©´ 'ì—†ìŒ'ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”" value={text7} onChange={e=>setText7(e.target.value)} />
                </div>
                <div style={s.card}>
                  <div style={s.qLabel}><span style={s.qNum}>8</span><span>í”¼í”ŒíŒ€ ë˜ëŠ” íšŒì‚¬ì— ì „ë‹¬í•˜ê³  ì‹¶ì€ ì´ì•¼ê¸°ê°€ ìˆë‹¤ë©´ í¸í•˜ê²Œ ì ì–´ì£¼ì„¸ìš”.</span></div>
                  <textarea style={s.textarea} placeholder="ì—†ìœ¼ë©´ 'ì—†ìŒ'ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”" value={text8} onChange={e=>setText8(e.target.value)} />
                </div>
              </div>
              <button style={s.submitBtn} onClick={submitting?undefined:submitSurvey} disabled={submitting}>
                {submitting?"ì œì¶œ ì¤‘...":"ì œì¶œí•˜ê¸° â†’"}
              </button>
            </div>
          )}

          {tab==="password" && (
            <div style={s.pwWrap}>
              <div style={{ fontSize:48, marginBottom:16 }}>ğŸ”’</div>
              <div style={{ fontFamily:"Georgia, serif", fontSize:24, color:"#2D5016", marginBottom:8 }}>í”¼í”ŒíŒ€ ì „ìš©</div>
              <div style={{ ...s.muted, marginBottom:28 }}>ì‘ë‹µ ê²°ê³¼ëŠ” í”¼í”ŒíŒ€ë§Œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.<br/>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
              <div style={{ display:"flex", gap:8, marginBottom:8 }}>
                <input style={{ ...s.input, flex:1 }} type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" value={pw} onChange={e=>setPw(e.target.value)} onKeyDown={e=>e.key==="Enter"&&checkPassword()} />
                <button style={s.pwBtn} onClick={checkPassword}>í™•ì¸</button>
              </div>
              {pwError && <div style={{ fontSize:13, color:"#C0392B", marginTop:6 }}>âš ï¸ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”!</div>}
            </div>
          )}

          {tab==="results" && isAuth && (
            <div style={s.rWrap}>
              <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:24, flexWrap:"wrap", gap:12 }}>
                <div style={{ fontFamily:"Georgia, serif", fontSize:26, color:"#2D5016" }}>ì‘ë‹µ ê²°ê³¼</div>
                <div style={{ display:"flex", gap:8, flexWrap:"wrap" }}>
                  <button style={{ background:"#2D5016", border:"none", color:"white", padding:"8px 14px", borderRadius:8, fontSize:12, cursor:"pointer", fontFamily:"inherit" }} onClick={downloadCSV}>â¬‡ï¸ CSV ë‹¤ìš´ë¡œë“œ</button>
                  <button style={{ background:"transparent", border:"1.5px solid #E0DDD6", color:"#888", padding:"8px 14px", borderRadius:8, fontSize:12, cursor:"pointer", fontFamily:"inherit" }} onClick={logout}>ë‚˜ê°€ê¸°</button>
                </div>
              </div>
              <div style={{ display:"flex", gap:8, marginBottom:28 }}>
                {[["trend","ğŸ“ˆ ì¶”ì´ ë¹„êµ"],["avg","ğŸ“Š ì‹œì ë³„ í‰ê· "],["list","ğŸ“‹ ì „ì²´ ì‘ë‹µ"]].map(([k,l])=>(
                  <button key={k} style={{ padding:"9px 18px", borderRadius:20, border:`1.5px solid ${resultTab===k?"#2D5016":"#E0DDD6"}`, background:resultTab===k?"#2D5016":"white", color:resultTab===k?"white":"#555", fontSize:13, fontWeight:600, cursor:"pointer", fontFamily:"inherit" }} onClick={()=>setResultTab(k)}>{l}</button>
                ))}
              </div>
              {loading ? (
                <div style={{ textAlign:"center", padding:60, color:"#888" }}>
                  <div style={{ fontSize:32, marginBottom:12 }}>â³</div>
                  <div>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
              ) : responses.length === 0 ? (
                <div style={{ textAlign:"center", padding:60, color:"#888" }}>
                  <div style={{ fontSize:40, marginBottom:12 }}>ğŸ“­</div>
                  <div>ì•„ì§ ì‘ë‹µì´ ì—†ì–´ìš”!</div>
                </div>
              ) : (
                <>
                  {resultTab==="trend" && (
                    <div>
                      <div style={{ fontSize:13, color:"#888", marginBottom:20, lineHeight:1.7 }}>êµ¬ì„±ì›ë³„ë¡œ <strong>3ê°œì›” â†’ 6ê°œì›” â†’ 1ë…„</strong>ì˜ í‰ê·  ì ìˆ˜ ë³€í™”ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.<br/>ì¹´ë“œë¥¼ í´ë¦­í•˜ë©´ ë¬¸í•­ë³„ ì ìˆ˜ë„ ë³¼ ìˆ˜ ìˆì–´ìš”.</div>
                      <div style={{ display:"flex", gap:16, marginBottom:20 }}>
                        {ROUNDS.map(rd=>(
                          <div key={rd} style={{ display:"flex", alignItems:"center", gap:6, fontSize:12 }}>
                            <div style={{ width:12, height:12, borderRadius:"50%", background:ROUND_COLOR[rd] }}/>
                            <span style={{ color:"#555" }}>{rd} ì°¨</span>
                          </div>
                        ))}
                      </div>
                      {personNames.map(pname => {
                        const pdata = byPerson[pname];
                        const roundsWithData = ROUNDS.filter(rd=>pdata[rd]);
                        const avgsPerRound = ROUNDS.map(rd=>pdata[rd]?(pdata[rd].scores.reduce((a,b)=>a+b,0)/pdata[rd].scores.length):null);
                        const isExpanded = expandedPerson === pname;
                        return (
                          <div key={pname} style={{ background:"white", border:"1.5px solid #E0DDD6", borderRadius:16, marginBottom:16, overflow:"hidden" }}>
                            <div style={{ padding:"18px 24px", cursor:"pointer", display:"flex", alignItems:"center", justifyContent:"space-between" }} onClick={()=>setExpandedPerson(isExpanded?null:pname)}>
                              <div style={{ display:"flex", alignItems:"center", gap:14, flex:1 }}>
                                <div>
                                  <div style={{ fontWeight:700, fontSize:15, marginBottom:4 }}>{pname}</div>
                                  <div style={{ display:"flex", gap:6 }}>
                                    {ROUNDS.map(rd=>(
                                      <span key={rd} style={{ fontSize:11, padding:"2px 9px", borderRadius:20, background:pdata[rd]?ROUND_BG[rd]:"#F0EDE6", color:pdata[rd]?ROUND_COLOR[rd]==="#A8D5FF"?"#2980B9":ROUND_COLOR[rd]:"#ccc", fontWeight:600, border:`1px solid ${pdata[rd]?ROUND_COLOR[rd]:"#E0DDD6"}` }}>
                                        {rd}{pdata[rd]?"âœ“":""}
                                      </span>
                                    ))}
                                  </div>
                                </div>
                                <div style={{ flex:1, display:"flex", alignItems:"flex-end", gap:4, height:44, padding:"0 16px", maxWidth:240 }}>
                                  {ROUNDS.map((rd,ri)=>{
                                    const val = avgsPerRound[ri];
                                    const prevVal = ri>0?avgsPerRound.slice(0,ri).filter(v=>v!==null).pop():null;
                                    const diff = val!==null&&prevVal!==null?val-prevVal:null;
                                    return (
                                      <div key={rd} style={{ display:"flex", flexDirection:"column", alignItems:"center", flex:1 }}>
                                        {val!==null?(
                                          <>
                                            <div style={{ fontSize:10, fontWeight:700, color:diff===null?"transparent":diff>0?"#2D5016":diff<0?"#C0392B":"#888", marginBottom:2 }}>
                                              {diff!==null&&diff!==0?(diff>0?`+${diff.toFixed(1)}`:diff.toFixed(1)):(diff===0?"â†’":"")}
                                            </div>
                                            <div style={{ width:"100%", background:ROUND_COLOR[rd], borderRadius:"4px 4px 0 0", height:`${(val/5)*36}px`, minHeight:4, position:"relative" }}>
                                              <div style={{ position:"absolute", top:-16, width:"100%", textAlign:"center", fontSize:10, fontWeight:700, color:"#2D5016" }}>{val.toFixed(1)}</div>
                                            </div>
                                          </>
                                        ):(
                                          <div style={{ width:"100%", borderRadius:"4px 4px 0 0", height:4, background:"#F0EDE6" }}/>
                                        )}
                                        <div style={{ fontSize:9, color:"#aaa", marginTop:2, whiteSpace:"nowrap" }}>{rd}</div>
                                      </div>
                                    );
                                  })}
                                </div>
                                <div style={{ textAlign:"right", marginLeft:"auto" }}>
                                  <div style={{ fontSize:11, color:"#888" }}>{roundsWithData.length}/3 ì™„ë£Œ</div>
                                  <div style={{ fontSize:12, marginTop:4 }}>{roundsWithData.length===3?"ğŸ†":roundsWithData.length===2?"ğŸŒ±":"ğŸŒ¾"}</div>
                                </div>
                              </div>
                              <div style={{ fontSize:18, color:"#aaa", marginLeft:16 }}>{isExpanded?"â–²":"â–¼"}</div>
                            </div>
                            {isExpanded&&(
                              <div style={{ borderTop:"1.5px solid #F0EDE6", padding:"20px 24px", background:"#FAFAF7" }}>
                                <div style={{ overflowX:"auto" }}>
                                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:13 }}>
                                    <thead>
                                      <tr>
                                        <th style={{ textAlign:"left", padding:"8px 12px", color:"#888", fontWeight:600, fontSize:11, borderBottom:"1.5px solid #E0DDD6", minWidth:200 }}>ë¬¸í•­</th>
                                        {ROUNDS.map(rd=><th key={rd} style={{ textAlign:"center", padding:"8px 12px", color:ROUND_COLOR[rd]==="#A8D5FF"?"#2980B9":ROUND_COLOR[rd], fontWeight:700, fontSize:11, borderBottom:"1.5px solid #E0DDD6", whiteSpace:"nowrap" }}>{rd} ì°¨</th>)}
                                        <th style={{ textAlign:"center", padding:"8px 12px", color:"#888", fontWeight:600, fontSize:11, borderBottom:"1.5px solid #E0DDD6" }}>ë³€í™”</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {Q_LABELS.map((ql,qi)=>{
                                        const qScores = ROUNDS.map(rd=>pdata[rd]?pdata[rd].scores[qi]:null);
                                        const filled = qScores.filter(v=>v!==null);
                                        const change = filled.length>=2?filled[filled.length-1]-filled[0]:null;
                                        return (
                                          <tr key={qi} style={{ background:qi%2===0?"white":"#F7F4EF" }}>
                                            <td style={{ padding:"9px 12px", fontSize:12, borderBottom:"1px solid #F0EDE6", lineHeight:1.4 }}>Q{qi+1}. {ql.slice(0,18)}â€¦</td>
                                            {ROUNDS.map(rd=>(
                                              <td key={rd} style={{ textAlign:"center", padding:"9px 12px", borderBottom:"1px solid #F0EDE6" }}>
                                                {pdata[rd]?<span style={{ fontWeight:700, fontSize:15, color:pdata[rd].scores[qi]>=4?"#2D5016":pdata[rd].scores[qi]===3?"#888":"#C0392B" }}>{pdata[rd].scores[qi]}</span>:<span style={{ color:"#ddd" }}>â€”</span>}
                                              </td>
                                            ))}
                                            <td style={{ textAlign:"center", padding:"9px 12px", borderBottom:"1px solid #F0EDE6", fontWeight:700, fontSize:13, color:change===null?"#ccc":change>0?"#2D5016":change<0?"#C0392B":"#888" }}>
                                              {change===null?"â€”":change>0?`â–² +${change}`:change<0?`â–¼ ${change}`:"â†’ 0"}
                                            </td>
                                          </tr>
                                        );
                                      })}
                                      <tr style={{ background:"#E8F5D8" }}>
                                        <td style={{ padding:"10px 12px", fontWeight:700, fontSize:12 }}>ğŸ“Š í‰ê· </td>
                                        {ROUNDS.map(rd=><td key={rd} style={{ textAlign:"center", padding:"10px 12px", fontWeight:700, fontSize:14, color:"#2D5016" }}>{pdata[rd]?(pdata[rd].scores.reduce((a,b)=>a+b,0)/pdata[rd].scores.length).toFixed(1):"â€”"}</td>)}
                                        <td style={{ textAlign:"center", padding:"10px 12px" }}>
                                          {(()=>{
                                            const avgs=ROUNDS.map(rd=>pdata[rd]?(pdata[rd].scores.reduce((a,b)=>a+b,0)/pdata[rd].scores.length):null).filter(v=>v!==null);
                                            if(avgs.length<2)return <span style={{color:"#ccc"}}>â€”</span>;
                                            const diff=avgs[avgs.length-1]-avgs[0];
                                            return <span style={{fontWeight:700,fontSize:13,color:diff>0?"#2D5016":diff<0?"#C0392B":"#888"}}>{diff>0?`â–² +${diff.toFixed(1)}`:diff<0?`â–¼ ${diff.toFixed(1)}`:"â†’ 0"}</span>;
                                          })()}
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </div>
                                {ROUNDS.filter(rd=>pdata[rd]).map(rd=>(
                                  <div key={rd} style={{ marginTop:16 }}>
                                    <div style={{ fontSize:11, fontWeight:700, color:ROUND_COLOR[rd]==="#A8D5FF"?"#2980B9":ROUND_COLOR[rd], marginBottom:6 }}>{rd} ì°¨ ({pdata[rd].date})</div>
                                    {pdata[rd].text7!=="ì—†ìŒ"&&<div style={{ fontSize:12, color:"#888", background:"white", padding:"8px 12px", borderRadius:8, border:"1px solid #E0DDD6", marginBottom:6 }}>ğŸ’¬ {pdata[rd].text7}</div>}
                                    {pdata[rd].text8!=="ì—†ìŒ"&&<div style={{ fontSize:12, color:"#888", background:"white", padding:"8px 12px", borderRadius:8, border:"1px solid #E0DDD6" }}>ğŸ“£ {pdata[rd].text8}</div>}
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  )}

                  {resultTab==="avg" && (
                    <div>
                      <div style={{ fontSize:13, color:"#888", marginBottom:24 }}>ê° ì‹œì ì—ì„œ ì‘ë‹µí•œ ì „ì²´ êµ¬ì„±ì›ì˜ ë¬¸í•­ë³„ í‰ê·  ì ìˆ˜ë¥¼ ë¹„êµí•´ìš”.</div>
                      <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:16, marginBottom:28 }}>
                        {ROUNDS.map((rd,ri)=>{
                          const data=roundAvgs[ri];
                          return(
                            <div key={rd} style={{ background:"white", border:`2px solid ${ROUND_COLOR[rd]}`, borderRadius:14, padding:20, textAlign:"center" }}>
                              <div style={{ fontSize:11, fontWeight:700, letterSpacing:1, color:ROUND_COLOR[rd]==="#A8D5FF"?"#2980B9":ROUND_COLOR[rd], marginBottom:8 }}>{rd} ì°¨</div>
                              <div style={{ fontFamily:"Georgia, serif", fontSize:36, color:"#2D5016", lineHeight:1 }}>{data?data.overall:"â€”"}</div>
                              <div style={{ fontSize:11, color:"#aaa", marginTop:6 }}>{data?`${data.count}ëª… ì‘ë‹µ`:"ì‘ë‹µ ì—†ìŒ"}</div>
                            </div>
                          );
                        })}
                      </div>
                      <div style={{ background:"white", border:"1.5px solid #E0DDD6", borderRadius:14, padding:24 }}>
                        <div style={s.sectionTitle}>ğŸ“Š ë¬¸í•­ë³„ ì‹œì  ë¹„êµ</div>
                        {Q_LABELS.map((ql,qi)=>(
                          <div key={qi} style={{ marginBottom:20 }}>
                            <div style={{ fontSize:12, fontWeight:600, marginBottom:10, color:"#333" }}>Q{qi+1}. {ql}</div>
                            {ROUNDS.map((rd,ri)=>{
                              const data=roundAvgs[ri];
                              const val=data?data.qAvgs[qi]:null;
                              const pct=val?val/5*100:0;
                              return(
                                <div key={rd} style={{ display:"flex", alignItems:"center", gap:12, marginBottom:6 }}>
                                  <div style={{ width:40, fontSize:11, fontWeight:700, color:ROUND_COLOR[rd]==="#A8D5FF"?"#2980B9":ROUND_COLOR[rd], flexShrink:0 }}>{rd}</div>
                                  <div style={{ flex:1, height:10, background:"#F0EDE6", borderRadius:6, overflow:"hidden", position:"relative" }}>
                                    {val&&<div style={{ height:"100%", width:`${pct}%`, background:ROUND_COLOR[rd]==="#A8D5FF"?"#A8D5FF":ROUND_COLOR[rd], borderRadius:6 }}/>}
                                    <div style={{ position:"absolute", top:-2, left:"60%", width:2, height:14, background:"#E67E22" }}/>
                                  </div>
                                  <div style={{ width:32, textAlign:"right", fontSize:12, fontWeight:700, color:val?"#2D5016":"#ccc" }}>{val?val.toFixed(1):"â€”"}</div>
                                </div>
                              );
                            })}
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {resultTab==="list" && (
                    <div style={{ background:"white", border:"1.5px solid #E0DDD6", borderRadius:14, overflow:"hidden" }}>
                      <div style={{ padding:"18px 24px", borderBottom:"1.5px solid #E0DDD6", fontSize:13, fontWeight:700, letterSpacing:1.5, textTransform:"uppercase", color:"#2D5016" }}>ğŸ“‹ ì „ì²´ ì‘ë‹µ ({responses.length}ê±´)</div>
                      {[...responses].reverse().map((r,idx)=>{
                        const rowAvg=(r.scores.reduce((a,b)=>a+b,0)/r.scores.length).toFixed(1);
                        return(
                          <div key={r.id} style={{ padding:"18px 24px", borderBottom:"1px solid #F0EDE6", background:idx%2===0?"white":"#FAFAF7" }}>
                            <div style={{ display:"flex", alignItems:"center", gap:10, marginBottom:10 }}>
                              <div style={{ fontWeight:700, fontSize:14 }}>{r.name}</div>
                              <span style={{ fontSize:11, padding:"2px 9px", borderRadius:20, background:ROUND_BG[r.round], color:ROUND_COLOR[r.round]==="#A8D5FF"?"#2980B9":ROUND_COLOR[r.round], fontWeight:600, border:`1px solid ${ROUND_COLOR[r.round]}` }}>{r.round} ì°¨</span>
                              <span style={{ fontSize:12, fontWeight:700, color:"#2D5016", marginLeft:4 }}>í‰ê·  {rowAvg}</span>
                              <div style={{ fontSize:11, color:"#aaa", marginLeft:"auto" }}>{r.date}</div>
                            </div>
                            <div style={{ marginBottom:8 }}>
                              {Q_LABELS.map((_,i)=>(
                                <span key={i} style={{ fontSize:11, padding:"3px 8px", borderRadius:6, background:"#F7F4EF", border:"1px solid #E0DDD6", marginRight:6, marginBottom:4, display:"inline-block" }}>
                                  Q{i+1} <strong style={{ color:r.scores[i]>=4?"#2D5016":r.scores[i]===3?"#888":"#C0392B" }}>{r.scores[i]}</strong>
                                </span>
                              ))}
                            </div>
                            {r.text7!=="ì—†ìŒ"&&<div style={{ fontSize:12, color:"#888", background:"white", padding:"8px 12px", borderRadius:8, border:"1px solid #E0DDD6", marginBottom:6, lineHeight:1.6 }}>ğŸ’¬ {r.text7}</div>}
                            {r.text8!=="ì—†ìŒ"&&<div style={{ fontSize:12, color:"#888", background:"white", padding:"8px 12px", borderRadius:8, border:"1px solid #E0DDD6", lineHeight:1.6 }}>ğŸ“£ {r.text8}</div>}
                          </div>
                        );
                      })}
                    </div>
                  )}
                </>
              )}
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
